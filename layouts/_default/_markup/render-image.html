{{ $image := .Page.Resources.GetMatch .Destination }}
<figure class="img-wrapper container"  style="width:{{$image.Width}}px" >

    {{ with .Title}}   <div class="title-img">{{ . }}</div> {{ end }}

    {{ if ne $image.MediaType.SubType  "gif" }}

        {{ if gt $image.Width 780 }}
            {{ if hugo.IsExtended }} 
            <source srcset="{{ ($image.Resize "780x q95 webp" ).RelPermalink | safeURL }}" type="image/webp">
            {{ end }}
            <source srcset="{{  ($image.Resize "780x jpg" ).RelPermalink | safeURL }}" type="image/jpeg">

            <source srcset="{{  ($image.Resize "780x" ).RelPermalink | safeURL }}" type="{{$image.MediaType}}">
            
        {{ else}}
            {{ if hugo.IsExtended }} 
            <source srcset="{{ ($image.Resize "x500 q90 webp" ).RelPermalink | safeURL }}" type="image/webp">
            {{ end }}
            <source srcset="{{  ($image.Resize "x500 jpg" ).RelPermalink | safeURL }}" type="image/jpeg">
            <source srcset="{{ ($image.Resize "x500" ).RelPermalink | safeURL }}" type="{{$image.MediaType}}">
        {{ end }}

    {{ end }}
    <source srcset="{{ $image.RelPermalink | safeURL }}" type="{{$image.MediaType}}">

   
    <img 
    class="post-img" 
    src="{{ $image.RelPermalink | safeURL }}" 
    {{ with .Text}}  alt="{{ . }}" {{ end }} 
    {{ with .Title}} title="{{ . }}"{{ end }} 
    loading="lazy"
     width="{{$image.Width}}" 
     height="{{$image.Height}}"
     type="{{$image.MediaType}}"
     />
     <a href="{{ .Destination | safeURL }}" target="_blank"  class="fullscreen-container" aria-label="Fullscreen image"> </a>
     
    {{ with .Text}}   <figcaption class="small" style="width:{{$image.Width}}px"> {{ . }}</figcaption> {{ end }}
</figure>

