{{ $image := .Page.Resources.GetMatch .Destination }}
<figure class="img-wrapper container picture"  style="width:{{$image.Width}}px" >
{{ $used:= $image}}
    {{ with .Title}}   <div class="title-img">{{ . }}</div> {{ end }}

    {{ if ne $image.MediaType.SubType  "gif" }}

        {{ if gt $image.Width 780 }}
            {{ if hugo.IsExtended }} 
            <source srcset="{{ ($image.Resize "780x q95 webp" ).RelPermalink | safeURL }}" type="image/webp">
            {{ end }}
            {{$used = ($image.Resize "780x jpg" )}}
            <source srcset="{{  ($used ).RelPermalink | safeURL }}" type="image/jpeg">


            
        {{ else}}
            {{ if hugo.IsExtended }} 
            <source srcset="{{ ($image.Resize "x500 q90 webp" ).RelPermalink | safeURL }}" type="image/webp">
            {{ end }}
            {{$used = ($image.Resize "x500 jpg" )}}
            <source srcset="{{  ($used ).RelPermalink | safeURL }}" type="image/jpeg">


        {{ end }}

    {{ end }}
    

   
    <img 
    class="post-img" 
    src="{{ $used.RelPermalink | safeURL }}" 
    {{ with .Text}}  alt="{{ . }}" {{ end }} 
    {{ with .Title}} title="{{ . }}"{{ end }} 
    loading="lazy"
     width="{{$used.Width}}" 
     height="{{$used.Height}}"
     type="image/jpeg"
     />
     <a href="{{ .Destination | safeURL }}" target="_blank"  class="fullscreen-container" aria-label="Fullscreen image"> </a>
     
    {{ with .Text}}   <figcaption class="small" style="width:{{$image.Width}}px"> {{ . }}</figcaption> {{ end }}
</figure>

